<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/header-apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/header-icon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/header-icon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="naExO9JokuG3a-OHUdrF8UrtMPNf1FyJ5Yt99ihFezY">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"klysisle.space","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="某次给内部同事的分享">
<meta property="og:type" content="article">
<meta property="og:title" content="优化Tips">
<meta property="og:url" content="https://klysisle.space/archives/c40e739.html">
<meta property="og:site_name" content="Klysisle&#39;s 小窝">
<meta property="og:description" content="某次给内部同事的分享">
<meta property="og:locale">
<meta property="og:image" content="https://klysisle.space/images/part101_infographics_v08.png">
<meta property="article:published_time" content="2024-04-02T11:40:09.000Z">
<meta property="article:modified_time" content="2024-12-11T08:54:40.712Z">
<meta property="article:author" content="Kinly">
<meta property="article:tag" content="C++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://klysisle.space/images/part101_infographics_v08.png">

<link rel="canonical" href="https://klysisle.space/archives/c40e739.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>优化Tips | Klysisle's 小窝</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Klysisle's 小窝</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Klysisle's 小窝</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://klysisle.space/archives/c40e739.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/kinly-avatar.png">
      <meta itemprop="name" content="Kinly">
      <meta itemprop="description" content="Klysisle's 小窝">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klysisle's 小窝">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          优化Tips
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-04-02 19:40:09" itemprop="dateCreated datePublished" datetime="2024-04-02T19:40:09+08:00">2024-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-12-11 16:54:40" itemprop="dateModified" datetime="2024-12-11T16:54:40+08:00">2024-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%9F%A5%E8%AF%86%E5%A4%87%E5%BF%98/" itemprop="url" rel="index"><span itemprop="name">知识备忘</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <div class="post-description">某次给内部同事的分享</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Optimizing-Tips"><a href="#Optimizing-Tips" class="headerlink" title="Optimizing Tips"></a>Optimizing Tips</h1><h1 id="某次给内部同事的分享"><a href="#某次给内部同事的分享" class="headerlink" title="某次给内部同事的分享"></a>某次给内部同事的分享</h1><h1 id="前提：先编写正确的代码，再优化"><a href="#前提：先编写正确的代码，再优化" class="headerlink" title="前提：先编写正确的代码，再优化"></a>前提：先编写正确的代码，再优化</h1><ul>
<li>先完成需求，实现业务内容，<strong>先让程序跑起来</strong></li>
<li>可能在做单元测试的过程中就可以看出哪个函数被频繁调用了，哪个逻辑做多了遍历或者搜索</li>
<li>然后分析以发现瓶颈（热点），并消除瓶颈（热点）</li>
<li>这样得到的成效往往是最直接和明确的</li>
<li>优化的顺序：要么先消除最大的那个热点，要么先消除一眼就可以改掉的那个热点</li>
<li>通常到最后是需要靠算法上的优化消除那个遗留下来的最麻烦的点，做这件事情的时候如果拿不准，就先多做粒度比较小的压测，找到适合的方式</li>
</ul>
<h1 id="优化核心："><a href="#优化核心：" class="headerlink" title="优化核心："></a>优化核心：</h1><ul>
<li>缓存命中、复用<ul>
<li>L 级缓存的命中</li>
<li>复用避免拷贝</li>
</ul>
</li>
<li>原子单位<ul>
<li>避免时间片跳出</li>
</ul>
</li>
<li>汇编指令重排<ul>
<li>重排指令</li>
<li>跳转、压栈、出栈的优化</li>
</ul>
</li>
<li>IO异步<ul>
<li>与其他设备级（网卡、磁盘等）交互的异步化</li>
</ul>
</li>
</ul>
<h1 id="循环调用："><a href="#循环调用：" class="headerlink" title="循环调用："></a>循环调用：</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">for</span> <span class="title">each</span> <span class="params">(<span class="keyword">auto</span>&amp; one : range(<span class="number">1</span>, <span class="number">100</span>))</span> </span>&#123;</span><br><span class="line">  <span class="built_in">caller</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">caller</span>() &#123;</span><br><span class="line">  <span class="function"><span class="keyword">for</span> <span class="title">each</span> <span class="params">(<span class="keyword">auto</span>&amp; one : range(<span class="number">1</span>, <span class="number">100</span>))</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>↓↓↓</p>
</li>
<li><p>函数调用需要两次跳转，还会有堆栈内存操作（参数&#x2F;返回值&#x2F;临时变量<br>压栈出栈）</p>
</li>
<li><p>优先使用迭代循环（相对递归来说），由于函数调用的栈空间是在出函数体才释放的，递归层级太深会导致栈溢出</p>
</li>
<li><p>可以使用（<strong>短的</strong>）内联函数消除函数跳转问题</p>
</li>
<li><p>循环内避免动态分配内存（new&#x2F;malloc）对于所有内存模型<br>ptmalloc&#x2F;tcmalloc&#x2F;jmalloc<br>这个动作很可能是要加锁的，循环本身是个cpu密集的行为，想象每次循环都被lock一下会怎么样？</p>
</li>
<li><p>可跳出的循环，尽量提早跳出，break&#x2F;return</p>
</li>
</ul>
<h1 id="遍历："><a href="#遍历：" class="headerlink" title="遍历："></a>遍历：</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> array[__line][__row] = &#123;&#123;...&#125;, &#123;...&#125; ...&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">unsigned</span> i : __line) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> j : __row) &#123;</span><br><span class="line">    array[i][j];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">unsigned</span> j : __row) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">unsigned</span> i : __line) &#123;</span><br><span class="line">    array[i][j];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>↓↓↓</li>
<li>数组的空间是连续的，也就是内存是连续的，顺序的访问内存和乱序（随机、跳转）访问内存性能差别很大</li>
<li><code>array[i][j]</code> 和 <code>array[i][j+1]</code> 相邻</li>
<li><code>array[i][j]</code> 和 <code>array[i+1][j]</code> 很远</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> std::vector&lt;...&gt;&amp; <span class="title">get_all</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> _all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span>&amp; all = <span class="built_in">get_all</span>();   <span class="comment">// 这里也是需要 const &amp; 取返回值的</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; one : all) &#123;  <span class="comment">// 这里也是需要 const &amp; 取迭代内容的</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">checker</span>(one)) <span class="keyword">continue</span>;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> std::vector&lt;...&gt;&amp; <span class="title">get_all_filter</span><span class="params">(std::function&lt;<span class="type">bool</span>(...)&gt;&amp;&amp; checker)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">  <span class="type">static</span> std::vector&lt;...&gt; result;</span><br><span class="line">  result.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; one : all) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">checker</span>(one))</span><br><span class="line">      result.<span class="built_in">push_back</span>(one);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span>&amp; all = <span class="built_in">get_all_filter</span>()</span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; one : all) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>↓↓↓</li>
<li>试想为什么有些程序会定义 attr 的宏来限制对数据成员的操作只有 get&#x2F;set</li>
</ul>
<h1 id="判断："><a href="#判断：" class="headerlink" title="判断："></a>判断：</h1><ul>
<li>如果不是要检查每种条件，把if… else if… else…<br>换成switch语句，编译器对swich更容易做优化，特别是switch常量那种</li>
<li>if 首先判断经常发生的情况</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (men) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (women) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">// other?</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="提前退出："><a href="#提前退出：" class="headerlink" title="提前退出："></a>提前退出：</h1><ul>
<li>循环&#x2F;遍历&#x2F;迭代<br>很多时候都是可以提前退出的，很多逻辑在纸上写（画）和代码写是两个思路</li>
</ul>
<h1 id="尽量少的参数数量："><a href="#尽量少的参数数量：" class="headerlink" title="尽量少的参数数量："></a>尽量少的参数数量：</h1><ul>
<li>简单类型的参数，如果数量足够少，尺寸足够小，会被压到寄存器里面，特别是外层有循环迭代的情况，寄存器访问比内存访问快的多</li>
<li>如果是仅函数内部使用的参数，使用std::move()，</li>
<li>如果是其他参数，使用 const xx&amp; (不可被改变), xx&amp; (可被改变)</li>
</ul>
<h1 id="尽量少的局部变量："><a href="#尽量少的局部变量：" class="headerlink" title="尽量少的局部变量："></a>尽量少的局部变量：</h1><ul>
<li>（同参数解释）</li>
<li>局部变量如果是在一个空间内使用的 {}, 在空间内声明，比如 if { int a &#x3D; 0; }</li>
<li>局部变量一样，声明必带初始化（不要相信编译器对常规变量的默认初始化）</li>
</ul>
<h1 id="尽量简单的返回值：（std-move语义）"><a href="#尽量简单的返回值：（std-move语义）" class="headerlink" title="尽量简单的返回值：（std::move语义）"></a>尽量简单的返回值：（std::move语义）</h1><h1 id="尽量使用引用传递参数-返回值：（对于成员变量）"><a href="#尽量使用引用传递参数-返回值：（对于成员变量）" class="headerlink" title="尽量使用引用传递参数&#x2F;返回值：（对于成员变量）"></a>尽量使用引用传递参数&#x2F;返回值：（对于成员变量）</h1><ul>
<li>作为参数，想不到有什么场景是需要以值传递的…</li>
<li>返回值需要关注是否在函数退出会被释放（栈空间），如果是可以用 static<br>修饰</li>
<li>stl clear 语义比 construct 语义快很多</li>
<li>swap 语义一般是用新对象覆盖，不同的方式开销不一样，再讨论…</li>
<li>如果知道容器需要的容量，提前 reserve，特别是 vector<br>这种容器，所以新标准有了 array</li>
</ul>
<h1 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h1><ul>
<li>定长容器虽然有限制，但是对内存更友好;<br>如果是可以预估数量级的数据，优先使用定长容器或者reserve<br>(<a target="_blank" rel="noopener" href="https://baptiste-wicht.com/posts/2012/12/cpp-benchmark-vector-list-deque.html">https://baptiste-wicht.com/posts/2012/12/cpp-benchmark-vector-list-deque.html</a>)</li>
<li>std::unordered_map 相比 std::map<br>时间复杂度更低，但是是在较大的数据量上；较小的数据量，较复杂的key（长std::string）带来的hash消耗会导致std::unordered_map不如std::map更快</li>
<li>同理 std::unordered_set std::set</li>
<li>嵌套的容器在语义和理解上都更不友好，添加 make_key 方法 -&gt;<br>std::string, std::tuple, user-define struct</li>
<li>如果 make_key 需要<br>hash，尽量用主流的hash算法，注意碰撞和算法本身的消耗</li>
<li>一般情况 user-define struct 都可以被 std::tuple<br>替代，虽然缺少了struct明确的语义，但是std::tuple的可展开性更容易写通用的hash函数</li>
<li>see:<br><a target="_blank" rel="noopener" href="https://www.boost.org/doc/libs/1_35_0/doc/html/boost/hash_combine_id241013.html">https://www.boost.org/doc/libs/1_35_0/doc/html/boost/hash_combine_id241013.html</a></li>
</ul>
<h1 id="轻量化调用链路：-（这只是一个更清楚的感受）"><a href="#轻量化调用链路：-（这只是一个更清楚的感受）" class="headerlink" title="轻量化调用链路： （这只是一个更清楚的感受）"></a>轻量化调用链路： （这只是一个更清楚的感受）</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">call_a</span>(...);</span><br><span class="line"><span class="built_in">call_b</span>(...);</span><br><span class="line"><span class="built_in">call_c</span>(...);</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">call_b</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">call_c</span>(...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">function <span class="title">call_a</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">call_b</span>(...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">call_a</span>(...);</span><br></pre></td></tr></table></figure>

<h1 id="虚函数："><a href="#虚函数：" class="headerlink" title="虚函数："></a>虚函数：</h1><ul>
<li>虚函数比普通函数调用的代价高很多… 这个是必要的么？ 参考 CRTP</li>
<li>虚函数相比普通函数调用的代价从cpu crycle 来看并没有高多少；只是多了一次虚表查询，但是这个查询的代价可以被认为是固定的（虚函数表指针（vptr）则存放在类对象最前面的位置，即对象内存布局的最前面）<a href="##%E5%8F%82%E8%80%83"></a></li>
<li>但虚函数的问题是：<ul>
<li><strong>虚函数被滥用了</strong>，看到很多同学做设计时把继承于基类对象的所有方法都定义为虚函数（为了使用时只用基类类型就可以），这会导致虚函数表的膨胀，增加内存消耗，增加内存访问的消耗</li>
<li><strong>虚函数不能像普通函数一样在编译期被优化</strong> （inline&#x2F;constexpr）</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// crtp 不是灵丹妙药，模板的引入导致引入了更多类型；这只是反virtual的的宣誓。（当然他的性能确实更好）</span></span><br><span class="line"><span class="comment">// The Curiously Recurring Template Pattern (CRTP)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">  <span class="comment">// methods within Base can use template to access members of Derived</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base&lt;Derived&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>see:<br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern">https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern</a></li>
</ul>
<h1 id="明确类型："><a href="#明确类型：" class="headerlink" title="明确类型："></a>明确类型：</h1><ul>
<li>数据处理上尽量明确类型，避免 cast<ul>
<li>不同数据类型所需要的空间是不一样的，甚至缓存他们的寄存器都不一样(int&#x2F;float)</li>
<li>每次cast都相当于要检查寄存器空间，甚至切换寄存器</li>
</ul>
</li>
<li>see: <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%AF%84%E5%AD%98%E5%99%A8">https://zh.wikipedia.org/wiki/%E5%AF%84%E5%AD%98%E5%99%A8</a></li>
</ul>
<h1 id="构造函数："><a href="#构造函数：" class="headerlink" title="构造函数："></a>构造函数：</h1><ul>
<li>新标准有了默认初始化方式</li>
<li>额外需要初始化的尽量写在初始化列表区，而不是构造的函数体</li>
<li>不要相信默认构造函数</li>
<li>加上右值构造，可能今后这个才更常被调用到</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">abc</span> &#123;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _a = <span class="number">0</span>;  <span class="comment">// 1.</span></span><br><span class="line">    <span class="type">int</span> _b;</span><br><span class="line">    <span class="type">int</span> _c;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">abc</span><span class="params">()</span></span></span><br><span class="line"><span class="function">      : _b(<span class="number">1</span>), _c(<span class="number">2</span>) &#123;</span>  <span class="comment">// 2.</span></span><br><span class="line">       <span class="comment">// _a = 0; _b = 1; _c = 2; // 3.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="初始化："><a href="#初始化：" class="headerlink" title="初始化："></a>初始化：</h1><ul>
<li>对象&#x2F;结构的声明直接做初始化<ul>
<li>abc abc_(1);</li>
<li>abc abc_; abc_ &#x3D; …</li>
<li>想要再编译器检查这个写法：explicit</li>
<li>stl 的初始化，参考 std::initializer_list</li>
</ul>
</li>
</ul>
<h1 id="析构函数："><a href="#析构函数：" class="headerlink" title="析构函数："></a>析构函数：</h1><ul>
<li>构造析构是继承 override<br>上基类和派生类命名不同的函数（其实他们的函数一个是没有函数名，一个是~）</li>
<li>派生类析构后会调用基类的析构，但是如果基类没有虚析构，指向基类的对象就认为需要释放的只是他自己（虚表找不到析构）</li>
<li>感谢编译器在基类virtual修饰的函数上默认派生类是可以不写 virtual<br>override 的，但也造成了不清不楚的问题</li>
<li>如果就是不想要虚析构，用 final 修饰你的结构</li>
</ul>
<h1 id="数据运算"><a href="#数据运算" class="headerlink" title="数据运算"></a>数据运算</h1><ul>
<li><p>数据运算尽量避免三元运算符</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = a + <span class="number">1</span>; <span class="comment">// 如果可以，用 += 替换</span></span><br><span class="line">a += <span class="number">1</span>;    <span class="comment">// -=, *=, /= 同理</span></span><br><span class="line">a = bool_ ? x : y;  <span class="comment">// 三元运算符会产生额外的变量</span></span><br></pre></td></tr></table></figure>

<ul>
<li>上面乍一看只是简单数据类型，一些新的编译器会做优化，但是如果a的类型是一个<br>struct… 比如坐标点(x, y, z)</li>
<li>+&#x3D; 相比 + 可以减少一次临时对象的分配</li>
<li>同理 ++a, a++</li>
</ul>
</li>
<li><p>see: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Expression_templates">https://en.wikipedia.org/wiki/Expression_templates</a></p>
</li>
</ul>
<h1 id="数据类型："><a href="#数据类型：" class="headerlink" title="数据类型："></a>数据类型：</h1><ul>
<li>数据在内存里操作的最小单位是4字节(int)，int8, int16,<br>如果涉及计算，会被用4字节空间计算，然后再转化成对应类型；所以才有代码用<br>8, 16 类型只做常量声明</li>
</ul>
<h1 id="rename"><a href="#rename" class="headerlink" title="rename:"></a>rename:</h1><ul>
<li>一定有必要 rename 数据类型么？如果需要，语言层面 using<br>更好看（相比类外的 typedef，甚至 #define）</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">string_view</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">using</span> value_type = <span class="type">char</span>;</span><br><span class="line">  <span class="keyword">using</span> pointer = <span class="type">char</span>*;</span><br><span class="line">  <span class="keyword">using</span> const_pointer = <span class="type">const</span> <span class="type">char</span>*;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="auto-delete"><a href="#auto-delete" class="headerlink" title="auto delete:"></a>auto delete:</h1><ul>
<li><p>如果 std::shared_ptr&lt;&gt; 不是所有人都接受的新内容（被遗忘的<br>std::weak_ptr&lt;&gt;）</p>
</li>
<li><p>std::unique_ptr&lt;&gt;<br>一定可以让你的代码更干净，毕竟更多的情况不是内存申请出来就可以继续使用的</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_ptr&lt;abc&gt; <span class="title">abc_</span><span class="params">(<span class="keyword">new</span> abc())</span></span>;</span><br><span class="line"><span class="keyword">if</span> (!abc_-&gt;<span class="built_in">testOK</span>(...) || !<span class="built_in">testOK</span>(abc_)) &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// delete abc;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Ty&gt;</span></span><br><span class="line"><span class="function">std::shared_ptr&lt;_Ty&gt; <span class="title">make_shared_array</span><span class="params">(<span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">shared_ptr</span>&lt;_Ty&gt;(<span class="keyword">new</span> _Ty[size], std::<span class="built_in">default_delete</span>&lt;_Ty[]&gt;());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Ty, <span class="keyword">class</span>... Args&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">typename</span> std::enable_if&lt;!std::is_array&lt;_Ty&gt;::value, std::unique_ptr&lt;_Ty&gt;&gt;::<span class="function">type <span class="title">make_unique</span><span class="params">(Args&amp;&amp;... args)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">unique_ptr</span>&lt;_Ty&gt;(<span class="keyword">new</span> _Ty(std::forward&lt;Args&gt;(args)...));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Ty&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">typename</span> std::enable_if&lt;std::is_array&lt;_Ty&gt;::value &amp;&amp; std::extent&lt;_Ty&gt;::value == <span class="number">0</span>, std::unique_ptr&lt;_Ty&gt;&gt;::type</span><br><span class="line"><span class="built_in">make_unique</span>(<span class="type">size_t</span> size) &#123;</span><br><span class="line">  <span class="keyword">using</span> _reTy = <span class="keyword">typename</span> std::remove::extent&lt;_Ty&gt;::type;</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">unique_ptr</span>&lt;_Ty&gt;(<span class="keyword">new</span> _reTy[size]());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="讨论："><a href="#讨论：" class="headerlink" title="讨论："></a>讨论：</h1><ul>
<li>C++的引用类型是一种选择；而其他语言 java&#x2F;c#<br>引用是唯一的选择（不要争执span，毕竟是会在编译期被提醒的），为什么？</li>
<li>多态有静多态, 动多态；为什么？</li>
<li>typedef 初衷应该是为了明确语义，隐藏模板的侵入；不要让他污染了你的程序</li>
<li>auto 并不能解析出 &amp; ，只是 auto x &#x3D; <a href=""></a> -&gt; const type_x&amp; {…};<br>是一个拷贝</li>
<li>在纸上画结构，标记逻辑跳出点（纸上的逻辑比程序更清楚）</li>
<li>在纸上列出已有的内容，和想求得的结果（纸上的算法优化比程序更直接）</li>
</ul>
<h1 id="…"><a href="#…" class="headerlink" title="…."></a>….</h1><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-</span> 避免繁复的设计。（架构设计是横向的，内容（实现）设计是纵向的，期望最终得到的是一个近似正方形）</span><br><span class="line"><span class="operator">-</span> 清理无用代码，除非很简单并且很可能被用到</span><br><span class="line"><span class="operator">-</span> 先想好怎么测试再开始</span><br><span class="line"><span class="operator">-</span> 关注方法论。</span><br></pre></td></tr></table></figure>

<h1 id="附录："><a href="#附录：" class="headerlink" title="附录："></a>附录：</h1><h2 id="系统的各种延时："><a href="#系统的各种延时：" class="headerlink" title="系统的各种延时："></a>系统的各种延时：</h2><table>
<thead>
<tr>
<th>事件</th>
<th>延迟</th>
<th>相对事件比例</th>
</tr>
</thead>
<tbody><tr>
<td>1个CPU周期</td>
<td>0.3 ns</td>
<td>1 s</td>
</tr>
<tr>
<td>L1 缓存访问</td>
<td>0.9 ns</td>
<td>3 s</td>
</tr>
<tr>
<td>L2 缓存访问</td>
<td>2.8 ns</td>
<td>9 s</td>
</tr>
<tr>
<td>L3 缓存访问</td>
<td>12.9 ns</td>
<td>43 s</td>
</tr>
<tr>
<td>主存访问(从CPU访问DRAM)</td>
<td>120 ns</td>
<td>6 分</td>
</tr>
<tr>
<td>固态硬盘I&#x2F;O(闪存)</td>
<td>50-150 us</td>
<td>2-6 天</td>
</tr>
<tr>
<td>旋转磁盘I&#x2F;O</td>
<td>1-10 ms</td>
<td>1-12 月</td>
</tr>
<tr>
<td>互联网：从旧金山到纽约</td>
<td>40 ms</td>
<td>4 年</td>
</tr>
<tr>
<td>互联网：从旧金山到英国</td>
<td>81 ms</td>
<td>8 年</td>
</tr>
<tr>
<td>互联网：从旧金山到澳大利亚</td>
<td>183 ms</td>
<td>19 年</td>
</tr>
<tr>
<td>TCP 包重传</td>
<td>1-3 s</td>
<td>105-317 年</td>
</tr>
<tr>
<td>OS 虚拟化系统重启</td>
<td>4 s</td>
<td>423 年</td>
</tr>
<tr>
<td>SCSI 命令超时</td>
<td>30 s</td>
<td>3 千年</td>
</tr>
<tr>
<td>硬件虚拟化系统重启</td>
<td>40 s</td>
<td>4 千年</td>
</tr>
<tr>
<td>物理系统重启</td>
<td>5 m</td>
<td>32 千年</td>
</tr>
</tbody></table>
<h2 id="物理距离-网速基准值推算公式："><a href="#物理距离-网速基准值推算公式：" class="headerlink" title="物理距离-&gt;网速基准值推算公式："></a>物理距离-&gt;网速基准值推算公式：</h2><ul>
<li>光速：299792458 m&#x2F;s -&gt; 300000 km&#x2F;s</li>
<li>光纤是经物理介质的，理论值会比光经空气慢；一般简化用 200000 km&#x2F;s<br>为参考</li>
<li>eg. <code>新加坡 - 美弗吉尼亚</code> 物理距离: 15000 km；单程时间：15000 &#x2F; 200000<br>* 1000 &#x3D; 75 ms；RTT（ping）约 150 ms</li>
</ul>
<h2 id="术语："><a href="#术语：" class="headerlink" title="术语："></a>术语：</h2><ul>
<li><code>IOPS:</code><br>每秒发生的输入&#x2F;输出操作的次数，是数据传说的一个对量方法。对于磁盘的读写，<code>IOPS</code><br>指的是每秒读和写的次数。</li>
<li><code>吞吐量:</code><br>评价工作执行的速率，尤其是在数据传输方面，这个属于用于描述数据传输速度（字节&#x2F;秒或者比特&#x2F;秒）。再某些情况下（如数据库），吞吐量指的是操作的速度（每秒操作数或每秒业务数）</li>
<li><code>相应时间:</code><br>一次操作完成的时间。包括用于等待和服务的时间，也包括用来返回结果的时间。</li>
<li><code>延时:</code><br>延时是描述操作里用来等待服务的时间。再某些情况下，它可以指的是整个操作时间，等同于响应时间。</li>
<li><code>使用率:</code><br>对于服务所请求的资源，使用率描述再所给定的时间区间内资源的繁忙程度。对于存储资源来说，使用率指的就是所消耗的存储容量（例如，内存使用率）。</li>
<li><code>饱和度:</code> 指的是某一资源无法满足服务的排队工作量。</li>
<li><code>瓶颈:</code><br>在系统性能里，瓶颈指的是限制系统性能的那个资源。分辨和移除系统瓶颈是系统性能的一项重要工作。</li>
<li><code>工作负载:</code><br>系统的输入或者是对系统所时间的负载叫做工作负载。对于数据库来说，工作负载就是客户端发出的数据库请求和命令。</li>
<li><code>缓存:</code><br>用于复制或者缓冲一定量数据的高速存储区域，目的是为了避免对较慢的存储层级的直接访问，从而提高性能。出于经济考虑，缓存区的容量要比更慢以及的存储容量要小。</li>
</ul>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ul>
<li><code>延时：</code>低应用响应时间</li>
<li><code>吞吐量：</code>高应用程序操作率或者数据传输率</li>
<li><code>资源使用率：</code>对于给定应用程序工作负载，高效的使用资源</li>
</ul>
<h2 id="大O标记法"><a href="#大O标记法" class="headerlink" title="大O标记法"></a>大O标记法</h2><table>
<thead>
<tr>
<th>标记法</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>O(1)</td>
<td>布尔判断</td>
</tr>
<tr>
<td>O(logn)</td>
<td>顺序队列的二分搜索</td>
</tr>
<tr>
<td>O(n)</td>
<td>链表的线性搜索</td>
</tr>
<tr>
<td>O(nlogn)</td>
<td>快速排序（一般情况）</td>
</tr>
<tr>
<td>O(n^2)</td>
<td>冒泡排序（一般情况）</td>
</tr>
<tr>
<td>O(2^n)</td>
<td>分解质因数；指数增长</td>
</tr>
<tr>
<td>O(n!)</td>
<td>旅行商人问题的穷举法</td>
</tr>
</tbody></table>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><img src="/../images/part101_infographics_v08.png"></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://ithare.com/infographics-operation-costs-in-cpu-clock-cycles/">http://ithare.com/infographics-operation-costs-in-cpu-clock-cycles/</a></li>
</ul>

    </div>
    
    
    
    <div>
      
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">------ 本文结束 ------</div>
        <div style="text-align:center;color: #ccc;font-size:14px;">------ 版权声明：转载请注明出处 ------</div>
    
</div>
      
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"># C++</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/archives/f9da676.html" rel="prev" title="近期优化备忘">
      <i class="fa fa-chevron-left"></i> 近期优化备忘
    </a></div>
      <div class="post-nav-item">
    <a href="/archives/b61fb416.html" rel="next" title="C++ std::function & lambda 性能损失">
      C++ std::function & lambda 性能损失 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Optimizing-Tips"><span class="nav-number">1.</span> <span class="nav-text">Optimizing Tips</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9F%90%E6%AC%A1%E7%BB%99%E5%86%85%E9%83%A8%E5%90%8C%E4%BA%8B%E7%9A%84%E5%88%86%E4%BA%AB"><span class="nav-number">2.</span> <span class="nav-text">某次给内部同事的分享</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E6%8F%90%EF%BC%9A%E5%85%88%E7%BC%96%E5%86%99%E6%AD%A3%E7%A1%AE%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%86%8D%E4%BC%98%E5%8C%96"><span class="nav-number">3.</span> <span class="nav-text">前提：先编写正确的代码，再优化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E6%A0%B8%E5%BF%83%EF%BC%9A"><span class="nav-number">4.</span> <span class="nav-text">优化核心：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E8%B0%83%E7%94%A8%EF%BC%9A"><span class="nav-number">5.</span> <span class="nav-text">循环调用：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%81%8D%E5%8E%86%EF%BC%9A"><span class="nav-number">6.</span> <span class="nav-text">遍历：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%EF%BC%9A"><span class="nav-number">7.</span> <span class="nav-text">判断：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8F%90%E5%89%8D%E9%80%80%E5%87%BA%EF%BC%9A"><span class="nav-number">8.</span> <span class="nav-text">提前退出：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%BD%E9%87%8F%E5%B0%91%E7%9A%84%E5%8F%82%E6%95%B0%E6%95%B0%E9%87%8F%EF%BC%9A"><span class="nav-number">9.</span> <span class="nav-text">尽量少的参数数量：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%BD%E9%87%8F%E5%B0%91%E7%9A%84%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%EF%BC%9A"><span class="nav-number">10.</span> <span class="nav-text">尽量少的局部变量：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%BD%E9%87%8F%E7%AE%80%E5%8D%95%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC%EF%BC%9A%EF%BC%88std-move%E8%AF%AD%E4%B9%89%EF%BC%89"><span class="nav-number">11.</span> <span class="nav-text">尽量简单的返回值：（std::move语义）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%BD%E9%87%8F%E4%BD%BF%E7%94%A8%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0-%E8%BF%94%E5%9B%9E%E5%80%BC%EF%BC%9A%EF%BC%88%E5%AF%B9%E4%BA%8E%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%EF%BC%89"><span class="nav-number">12.</span> <span class="nav-text">尽量使用引用传递参数&#x2F;返回值：（对于成员变量）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8"><span class="nav-number">13.</span> <span class="nav-text">容器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BD%BB%E9%87%8F%E5%8C%96%E8%B0%83%E7%94%A8%E9%93%BE%E8%B7%AF%EF%BC%9A-%EF%BC%88%E8%BF%99%E5%8F%AA%E6%98%AF%E4%B8%80%E4%B8%AA%E6%9B%B4%E6%B8%85%E6%A5%9A%E7%9A%84%E6%84%9F%E5%8F%97%EF%BC%89"><span class="nav-number">14.</span> <span class="nav-text">轻量化调用链路： （这只是一个更清楚的感受）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%99%9A%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="nav-number">15.</span> <span class="nav-text">虚函数：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%98%8E%E7%A1%AE%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="nav-number">16.</span> <span class="nav-text">明确类型：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="nav-number">17.</span> <span class="nav-text">构造函数：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%9A"><span class="nav-number">18.</span> <span class="nav-text">初始化：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="nav-number">19.</span> <span class="nav-text">析构函数：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%BF%90%E7%AE%97"><span class="nav-number">20.</span> <span class="nav-text">数据运算</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="nav-number">21.</span> <span class="nav-text">数据类型：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rename"><span class="nav-number">22.</span> <span class="nav-text">rename:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#auto-delete"><span class="nav-number">23.</span> <span class="nav-text">auto delete:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%A8%E8%AE%BA%EF%BC%9A"><span class="nav-number">24.</span> <span class="nav-text">讨论：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E2%80%A6"><span class="nav-number">25.</span> <span class="nav-text">….</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%99%84%E5%BD%95%EF%BC%9A"><span class="nav-number">26.</span> <span class="nav-text">附录：</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%90%84%E7%A7%8D%E5%BB%B6%E6%97%B6%EF%BC%9A"><span class="nav-number">26.1.</span> <span class="nav-text">系统的各种延时：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%A9%E7%90%86%E8%B7%9D%E7%A6%BB-%E7%BD%91%E9%80%9F%E5%9F%BA%E5%87%86%E5%80%BC%E6%8E%A8%E7%AE%97%E5%85%AC%E5%BC%8F%EF%BC%9A"><span class="nav-number">26.2.</span> <span class="nav-text">物理距离-&gt;网速基准值推算公式：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AF%E8%AF%AD%EF%BC%9A"><span class="nav-number">26.3.</span> <span class="nav-text">术语：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">26.4.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7O%E6%A0%87%E8%AE%B0%E6%B3%95"><span class="nav-number">26.5.</span> <span class="nav-text">大O标记法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">26.6.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Kinly"
      src="/uploads/kinly-avatar.png">
  <p class="site-author-name" itemprop="name">Kinly</p>
  <div class="site-description" itemprop="description">Klysisle's 小窝</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      friendly
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://gqw.github.io/" title="https:&#x2F;&#x2F;gqw.github.io&#x2F;" rel="noopener" target="_blank">顾起威's blog</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kinly</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>



  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : ,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>












  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '6741134bc57bd79787a9',
      clientSecret: 'ce6491d7fecebe5bf246e104cbae0f3412cc9c92',
      repo        : 'kinly.github.io',
      owner       : 'kinly',
      admin       : ['kinly'],
      id          : '6244817768ed466f6285441060e1596d',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
